---
layout: post
title: Look out - Locale Gotcha
date: '2016-12-12T01:06:00.001-08:00'
author: Allan Bowe
tags: 
modified_time: '2016-12-12T02:45:52.122-08:00'
thumbnail: https://1.bp.blogspot.com/-YeA9yqR00FE/WE5oARxeLKI/AAAAAAAAAwo/4dYLrPnzh8UOI9koMB1vlU4w2-gTnuQ2QCLcB/s72-c/Capture.PNG
blogger_id: tag:blogger.com,1999:blog-3488921339026456633.post-5418958681000675140
blogger_orig_url: http://www.rawsas.com/2016/12/look-out-locale-gotcha.html
---

As gotcha's go, this was a good one!<br /><br />We had a report being generated with dates that were inconsistent with the source file (MMDDYY instead of DDMMYY), but only for certain records. &nbsp;This was definitely related to the <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">ANYDTDTE</span>. informat, but the strange thing was - this issue only occurred when the report was generated by the Stored Process Server (it was fine in batch).<br /><br />The&nbsp;<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">ANYDTDTE</span>. informat is driven by the locale setting but as per the chain of sasv9.cfg files we had&nbsp;<span style="font-family: Courier New, Courier, monospace;">-LOCALE en_GB</span><span style="font-family: courier new, courier, monospace;">&nbsp;</span><span style="font-family: inherit;">defined for</span>&nbsp;both servers. &nbsp;So I checked the logs, and found something interesting..<br /><br />One of our STP applications can be triggered from either Excel or a browser. &nbsp;I could see that the same user had triggered two requests, less than a minute apart, one from excel and one from a browser (as evidenced by the value of the _HTUA variable)<br /><br />Yet one session had&nbsp;<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">_USERLOCALE=en_US</span> and the other had&nbsp;<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">_USERLOCALE=en_GB</span>!!<br /><br />As it turns out, the locale for a Stored Process session <i>can change according to the context of the client</i> - as described in this <a href="http://support.sas.com/kb/45/414.html" target="_blank">usage note</a>.<br /><br />So the fix is simply to add the following code (as per your desired locale):<br /><blockquote class="tr_bq"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">options locale=en_gb;</span></blockquote>But where?<br /><br />I tried fixing this via the autoexec, but this had no effect (likely because the server is running before the request arrives) so instead I added it to the stp init program - which worked a treat.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-YeA9yqR00FE/WE5oARxeLKI/AAAAAAAAAwo/4dYLrPnzh8UOI9koMB1vlU4w2-gTnuQ2QCLcB/s1600/Capture.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="84" src="https://1.bp.blogspot.com/-YeA9yqR00FE/WE5oARxeLKI/AAAAAAAAAwo/4dYLrPnzh8UOI9koMB1vlU4w2-gTnuQ2QCLcB/s320/Capture.PNG" width="320" /></a></div><br /><b>I recommend adding this to your init program</b>, unless you really do want your outputs to change according to the locale setting of the client application!